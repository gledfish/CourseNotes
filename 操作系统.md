# 操作系统
## 操作系统概述
 
  **操作系统的定义**：操作系统是控制管理计算机硬件和软件资源，合理地组织计算机的工作流程以方便用户使用的程序集合
地位：
* 裸机上的第一层软件
* 位于系统硬件之上，所有其他软件之下。
  
**操作系统的特征**
* 并发性：两个或多个事件在同一时间间隔内发生。（并发程序设计是操作系统形成的标志）
* 共享：操作系统中的硬件和软件资源不再为某个程序独享
* 虚拟：将硬件实体变为逻辑上的对应物
* 不确定性： 即使在相同的环境下，程序的执行结果也可能是不确定的，这也是操作系统要解决的问题
  
**操作系统的分类**
操作系统已有几十年的历史，已经形成了各式各样，适合不同场景的操作系统。其中分时操作系统是我们重点关注的。

**分时操作系统**
  特点：
  * 同时性：系统可以同时将多个用户终端连接到一个主机上，（此处的用户可以指具体的用户也可以指一个具体的进程），宏观上，各进程同时在一个时间片中运行，微观上，各进程轮流运行。
  * 独立性：各个用户进程互不影响
  * 及时性：终端用户的请求能够被及时响应
  * 交互性：用户能够与系统实现聊天式交互
    
Windows，Linux，Mac等操作系统都是分时操作系统。
## 作业管理和用户接口
操作系统为用户提供了两类接口：
* 作业控制级借口：如通过输入命令行直接控制操作系统，或者通过丰富的图形化控制来间接控制操作系统。
* 程序接口：通常由各种系统调用组成。用户可以在自己的程序中通过调用接口来请求系统调用

**作业**：一次事务中计算机系统所做工作的总和
根据处理方式的不同，将作业分为;
* 脱机作业：用户不直接与计算机系统交互，而通过操作员间接控制。脱机作业通常在批处理系统中
* 联机作业：用户直接与计算机进行交互，现代的单用户微机操作系统大都采用这种方式。
作业的处理过程：输入、准备、执行、完成。
**作业的输入/输出**
* 脱机输入/输出：通过脱机外围设备搭建主机和输入输出设备的桥梁。但是人工操作效率低
* 联机输入输出：由主机直接控制，降低了CPU的利用率

SPOOLing系统：在通道技术和多道程序设计的基础上，利用一台可共享的，高速大容量的磁盘设备来模拟独占设备的操作，在逻辑上实现多台可并行使用的虚拟设备。从而在联机状态下实现了脱机的效果。又称为“伪脱机”。
**作业调度**
* 低级调度：决定CPU可以占据哪个进程
* 中级调度：负责决定进程在内存和辅寸盘交换区间的对换
* 高级调度： 将系统中的作业按照调度算法选择进入内存区

**调度算法**
* 先到先处理算法（FCFS）：按照进程进入内存区的先后进行处理，利于处理长作业和CPU繁忙型作业，不利于I/O繁忙型的作业
* 短作业优先算法（SJF）:按照作业的估计运行时间的长短进行排队，可以有效处理短作业，降低作业的平均等待时间。但是容易造成长作业持续等待的情况。

以上两种方法各有优缺点，还有一种折中的算法：**最高响应比优先调度算法（HRP）**
$$
优先权  = （等待时间 + 执行时间）/ 执行时间
R
$$
等待时间越长，优先权越大。先处理优先权的作业。可以避免某个作业持续等待。

算法的性能描述
* CPU利用率：CPU工作时间的占比
* 吞吐量：完成作业的数量
* 周转时间：一个任务从提交到结束。其中主要包括等待时间和运行时间。

**作业控制**
* 脱机作业控制：用户输入作业说明书，整个作业的运行由系统控制。该方法适合非专业人士
* 联机作业控制：通过联机命令语言和会话式程序设计语言控制作业运行（如linux下的shell脚本编程语言，这种方法更适合专业人士）

### 系统功能调用
程序运行的状态大体可以分为两类
* 管态：又叫系统态、核心态，是操作系统程序运行的状态
* 算态：又叫用户态、目态，是用户程序运行程序的状态
**系统功能调用**：只能在管态下执行的指令，而不能在算态下调用的一类专用指令叫**特权指令**。如果算态希望执行特权指令，就需要向系统进行申请，并中断当前算态的工作状态进入管态，执行相应的指令，然后恢复算态当时的工作状态。**访管指令**便是进行这样的任务，算态可以通过调用访管指令来临时进入管态执行命令，并及时返回原来的状态。
系统调用和普通调用的区别
* 运行时在不同的程序状态
* 通过暂时中断进入
* 一般的过程调用，执行完后返回调用过程继续执行，而在采用了抢夺式调度方法的系统中，要先对所有的进程进行优先级的分析。
## 进程管理
### 进程（Progress）
简单说，进程是程序的一次执行，也是系统资源基本的分配单位和执行单位（现代操作系统中，执行由线程进行）
**进程的组成**
* 程序：
* 数据：
* 控制块(PCB)：保存进程的状态信息
**控制块**
  * 标识信息：惟一标识一个进程
  * 现场信息：记录进程占用CPU时的各种现场信息，可以用于进程被中断时恢复进程。
  * 控制信息：系统对进程控制时用到的信息

**进程的状态**
* 阻塞态：进程因为某个事件暂时不能运行，当条件满足时会进入就绪态
* 就绪态：其他运行资源已经就绪，等待系统为它分配CPU进入运行态
* 运行态：进程获得所有资源，并开始运行。

状态转换：
P64 图
  **管理进程**
  系统将同种状态的PCB排成一个队列，利用指针组成链表，方便查找和调度。
  
  

